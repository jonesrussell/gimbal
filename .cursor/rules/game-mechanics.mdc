---
description: Game mechanics and entity behavior patterns
globs: ["**/systems/**/*.go", "**/entities/**", "**/stages/**"]
alwaysApply: false
---

# Game Mechanics

## Player Movement
- Player orbits around screen center at fixed radius
- Movement controlled via Arrow Keys / WASD
- Use `SceneManager.RequestQuit()` for graceful shutdown, not `os.Exit()`

## Enemy System
- Enemy types: Basic (0), Heavy (1), Boss (2)
- Movement patterns: Normal, Zigzag, Accelerating, Pulsing
- Formations: Line, Circle, V, Diamond, Diagonal, Spiral, Random

## Collision Detection
- Uses spatial hashing for efficiency
- Timeout protection: `config.CollisionTimeout` (half frame budget)
- Player has invincibility frames after taking damage

## Stage Configuration
Stages are JSON files in `assets/stages/` (single source of truth). Each stage defines:
- Waves with spawn sequences, entry paths, behaviors, attack and fire patterns
- Boss configuration and difficulty
- Completion and progression

## Performance Thresholds
- Slow system threshold: `config.SlowSystemThreshold` (5ms)
- Debug logging interval: `config.DebugLogInterval` (60 frames)
- Use `ImagePool` for ebiten.Image reuse
