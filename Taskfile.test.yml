version: '3'

tasks:
  all:
    desc: Run all tests (race, coverage)
    cmds:
      - go test ./... -v -race -coverprofile=coverage.out -timeout=60s

  ci:
    desc: Run tests as in CI (includes integration)
    cmds:
      - go test ./... -v -race -tags=integration -timeout=60s

  short:
    desc: Run fast tests (no race)
    cmds:
      - go test ./... -v -short -timeout=30s

  race:
    desc: Run all tests with race detector
    cmds:
      - go test ./... -v -race -timeout=60s

  coverage:
    desc: Generate HTML coverage report
    cmds:
      - go test ./... -v -race -coverprofile=coverage.out -timeout=60s
      - go tool cover -html=coverage.out -o coverage.html

  bench:
    desc: Run benchmarks
    cmds:
      - go test -bench=. -benchmem ./... 